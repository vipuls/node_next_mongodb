{"version":3,"sources":["../../src/utils/cache.js"],"names":["setExpire","getCacheManager","cache","Manager","MockNowDate","date","undefined","push","pop","d","Date","expire","getData","data","valueOf","id","params","Object","keys","reduce","memo","key","value","oldDate","Number","setSeconds","getSeconds","ret"],"mappings":";;;;;;;;QA2CgBA,S,GAAAA,S;QAeAC,e,GAAAA,e;;kBAcD,UAASC,KAAT,EAAgB;AAC7B,MAAI,CAACA,KAAL,EAAY;AACV,WAAO,IAAP;AACD;AACD,MAAIA,UAAU,IAAd,EAAoB;AAClB,WAAOC,OAAP;AACD,GAFD,MAEO;AACL,wBAAYA,OAAZ,EAAwBD,KAAxB;AACD;AACF,C;;AAjFM,IAAME,oCAAc;AACzBC,QAAMC,SADmB;AAEzBC,MAFyB,gBAEpBF,IAFoB,EAEd;AACT,SAAKA,IAAL,GAAYA,IAAZ;AACD,GAJwB;AAKzBG,KALyB,iBAKnB;AACJ,QAAI,KAAKH,IAAT,EAAe;AACb,UAAMI,IAAI,KAAKJ,IAAf;AACA,WAAKA,IAAL,GAAYC,SAAZ;AACA,aAAO,IAAII,IAAJ,CAASD,CAAT,CAAP;AACD,KAJD,MAIO;AACL,aAAO,IAAIC,IAAJ,EAAP;AACD;AACF;AAbwB,CAApB;;AAgBA,IAAMP,4BAAU;AACrBQ,UAAQ,KADa;AAErBC,SAFqB,mBAEbV,KAFa,EAEN;AACb,QAAI,CAACA,KAAL,EAAY;AACV;AACD;AAHY,QAILS,MAJK,GAIYT,KAJZ,CAILS,MAJK;AAAA,QAIGE,IAJH,GAIYX,KAJZ,CAIGW,IAJH;;AAKb,QAAIF,WAAW,KAAX,IAAoBA,WAAWL,SAA/B,IAA4CK,WAAW,IAA3D,EAAiE;AAC/D,aAAOE,IAAP;AACD;AACD,QAAIF,kBAAkBD,IAAtB,EAA4B;AAC1B,UAAIC,OAAOG,OAAP,KAAmBV,YAAYI,GAAZ,GAAkBM,OAAlB,EAAvB,EAAoD;AAClD,eAAOD,IAAP;AACD;AACF;AACF,GAfoB;AAgBrBE,IAhBqB,cAgBlBC,MAhBkB,EAgBV;AACT,QAAI,CAACA,MAAL,EAAa;AACX,aAAO,EAAP;AACD;AACD,WAAOC,OAAOC,IAAP,CAAYF,MAAZ,EAAoBG,MAApB,CACL,UAACC,IAAD,EAAOC,GAAP;AAAA,aAAeD,QAAUC,GAAV,SAAiBL,OAAOK,GAAP,CAAjB,OAAf;AAAA,KADK,EAEL,EAFK,CAAP;AAID;AAxBoB,CAAhB;;AA2BA,SAASrB,SAAT,CAAmBsB,KAAnB,EAA0BC,OAA1B,EAAmC;AACxC,MAAIZ,SAASW,KAAb;AACA,MAAI,OAAOX,MAAP,KAAkB,QAAlB,IAA8BA,kBAAkBa,MAApD,EAA4D;AAC1D,QAAMf,IAAIL,YAAYI,GAAZ,EAAV;AACAC,MAAEgB,UAAF,CAAahB,EAAEiB,UAAF,KAAiBf,MAA9B;AACAA,aAASF,CAAT;AACD;AACD,MAAIc,mBAAmBb,IAAnB,IAA2BC,kBAAkBD,IAAjD,EAAuD;AACrD,QAAIC,OAAOG,OAAP,KAAmBS,QAAQT,OAAR,EAAvB,EAA0C;AACxCH,eAASY,OAAT;AACD;AACF;AACD,SAAOZ,MAAP;AACD;;AAEM,SAASV,eAAT,CAAyBU,MAAzB,EAAiCT,KAAjC,EAAwC;AAC7C,MAAIS,WAAWL,SAAf,EAA0B;AACxB,QAAMqB,mBAAWxB,OAAX,EAAuBD,KAAvB,CAAN;AACA,QAAIyB,IAAIhB,MAAJ,KAAe,KAAnB,EAA0B;AACxBgB,UAAIhB,MAAJ,GAAaX,UAAUW,MAAV,EAAkBgB,IAAIhB,MAAtB,CAAb;AACD;AACD,WAAOgB,GAAP;AACD,GAND,MAMO,IAAIzB,KAAJ,EAAW;AAChB,wBAAYC,OAAZ,EAAwBD,KAAxB;AACD,GAFM,MAEA;AACL,WAAO,IAAP;AACD;AACF","file":"cache.js","sourcesContent":["export const MockNowDate = {\n  date: undefined,\n  push(date) {\n    this.date = date;\n  },\n  pop() {\n    if (this.date) {\n      const d = this.date;\n      this.date = undefined;\n      return new Date(d);\n    } else {\n      return new Date();\n    }\n  }\n};\n\nexport const Manager = {\n  expire: false,\n  getData(cache) {\n    if (!cache) {\n      return;\n    }\n    const { expire, data } = cache;\n    if (expire === false || expire === undefined || expire === null) {\n      return data;\n    }\n    if (expire instanceof Date) {\n      if (expire.valueOf() > MockNowDate.pop().valueOf()) {\n        return data;\n      }\n    }\n  },\n  id(params) {\n    if (!params) {\n      return \"\";\n    }\n    return Object.keys(params).reduce(\n      (memo, key) => memo + `${key}=${params[key]};`,\n      \"\"\n    );\n  }\n};\n\nexport function setExpire(value, oldDate) {\n  let expire = value;\n  if (typeof expire === \"number\" || expire instanceof Number) {\n    const d = MockNowDate.pop();\n    d.setSeconds(d.getSeconds() + expire);\n    expire = d;\n  }\n  if (oldDate instanceof Date && expire instanceof Date) {\n    if (expire.valueOf() < oldDate.valueOf()) {\n      expire = oldDate;\n    }\n  }\n  return expire;\n}\n\nexport function getCacheManager(expire, cache) {\n  if (expire !== undefined) {\n    const ret = { ...Manager, ...cache };\n    if (ret.expire !== false) {\n      ret.expire = setExpire(expire, ret.expire);\n    }\n    return ret;\n  } else if (cache) {\n    return { ...Manager, ...cache };\n  } else {\n    return null;\n  }\n}\n\nexport default function(cache) {\n  if (!cache) {\n    return null;\n  }\n  if (cache === true) {\n    return Manager;\n  } else {\n    return { ...Manager, ...cache };\n  }\n}\n"]}